import getURL from "requrl";
import { parseURL } from "ufo";
import { isProduction } from "../../helpers.js";
import { resolveApiBaseURL } from "../../utils/url.js";
import { ERROR_MESSAGES } from "./errors.js";
import { useRuntimeConfig } from "#imports";
export function getServerOrigin(event) {
  const runtimeConfig = useRuntimeConfig();
  const baseURL = resolveApiBaseURL(runtimeConfig, false);
  const parsed = parseURL(baseURL);
  if (parsed.protocol && parsed.host) {
    return `${parsed.protocol}//${parsed.host}`;
  }
  if (event && !isProduction) {
    return getURL(event.node.req, false);
  }
  throw new Error(ERROR_MESSAGES.NO_ORIGIN);
}
